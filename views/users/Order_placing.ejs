<!-- include the header section of Html of Users -->
<%- include('../layouts/Users/header.ejs') %>
    <!-- include the navbar section of Users -->
    <%- include('../partial/User_page_header.ejs',{user:User,CartCount:cartcount}) %>
    <!-- Cart -->
	 <div class="wrap-header-cart js-panel-cart">
		<div class="s-full js-hide-cart"></div>

		<div class="header-cart flex-col-l p-l-65 p-r-25">
			<div class="header-cart-title flex-w flex-sb-m p-b-8">
				<span class="mtext-103 cl2">
					Your Cart
				</span>

				<div class="fs-35 lh-10 cl2 p-lr-5 pointer hov-cl1 trans-04 js-hide-cart">
					<i class="zmdi zmdi-close"></i>
				</div>
			</div>
			
			<div class="header-cart-content flex-w js-pscroll">
				<ul class="header-cart-wrapitem w-full">
                    <% for(x of CartItems) {%>
					<li class="header-cart-item flex-w flex-t m-b-12">
						<div class="header-cart-item-img">
							<img src="/images/Product_image/<%=x.product.images[0]%>" alt="IMG">
						</div>

						<div class="header-cart-item-txt p-t-8">
							<a href="#" class="header-cart-item-name m-b-18 hov-cl1 trans-04">
								<%=x.product.name%>
							</a>

							<span class="header-cart-item-info">
								<%=x.quantity%> x $<%=x.product.price%>
							</span>
						</div>
					</li>
                    <%}%>
				<div class="w-full">
					<div class="header-cart-total w-full p-tb-40">
						Total $
					</div>

					<div class="header-cart-buttons flex-w w-full">
						<a href="/Load_cart" class="flex-c-m stext-101 cl0 size-107 bg3 bor2 hov-btn3 p-lr-15 trans-04 m-r-8 m-b-10">
							View Cart
						</a>

						<a href="shoping-cart.html" class="flex-c-m stext-101 cl0 size-107 bg3 bor2 hov-btn3 p-lr-15 trans-04 m-b-10">
							Check Out
						</a>
					</div>
				</div>
			</div>
		</div>
	</div>
<!-- breadcrumb -->
<div class="container">
  <div class="bread-crumb flex-w p-l-25 p-r-15 p-t-30 p-lr-0-lg">
      <a href="/" class="stext-109 cl8 hov-cl1 trans-04">
          Home
          <i class="fa fa-angle-right m-l-9 m-r-10" aria-hidden="true"></i>
      </a>

      <span class="stext-109 cl4">
         Shopping Cart
      </span>

  </div>
</div>


<!-- Content page -->
<div class="container">
  <div class="main-body">

    
<div class="row gutters-sm">
    <div class="col-md-12">
      <div class="card mb-3">
        <div class="card-body">
          <form  id="Checkout-form" action="" method="">
            <div class="row mb-4">
            <div class="col px-4">
              <h1>You can see my Order Form</h1>
              <span>with some explanation below</span>
              <hr class="mt-1" />
          </div>
        </div>
            <!-- 2 column grid layout with text inputs for the first and last names -->
            <div class="row mb-4">
              <div class="col">
                <div class="form-outline">
                  <input type="text" name="UserId" id="form6Example2" class="form-control" value="<%=User%>" hidden/>
                  <label class="form-label" for="form6Example1">First name</label>
                  <input type="text"  name="fname" id="form6Example1" class="form-control" />

                </div>
              </div>
              <div class="col">
                <div class="form-outline">
                  <label class="form-label" for="form6Example2">Last name</label>
                  <input type="text" name="lname" id="form6Example2" class="form-control" />

                </div>
              </div>
            </div>
            <!-- 2 column grid layout with text inputs for the Email and Contact -->
            <div class="row mb-4">
              <div class="col">
                <div class="form-outline">
                  <label class="form-label" for="form6Example1">Email</label>
                  <input type="email" name="email" id="form6Example1" class="form-control" />

                </div>
              </div>
              <div class="col">
                <div class="form-outline">
                  <label class="form-label" for="form6Example2">Contact</label>
                  <input type="text" name="mob" id="form6Example2" class="form-control" />

                </div>
              </div>
            </div>

            <!-- Text input -->
            <div class="form-outline mb-4">
              <label class="form-label" for="form6Example2"> Billing Address</label>
              <hr>
            </div>

            <!-- Text input -->
            <div class="form-outline mb-4">
              <label class="form-label" for="form6Example4">Address</label>
              <input type="text" name="faddress" id="form6Example4"  class="form-control" placeholder="Street Address" />

            </div>
            <!-- Text input -->
            <div class="form-outline mb-4">

              <input type="text"  name="Saddress" id="form6Example4" class="form-control" placeholder="Street Address Line 2" />

            </div>

            <!-- 2 column grid layout with text inputs for the City and  state -->
            <div class="row mb-4">
              <div class="col">
                <div class="form-outline">

                  <input type="text" name="city" id="form6Example1" class="form-control " placeholder="City" />

                </div>
              </div>
              <div class="col">
                <div class="form-outline">

                  <input type="text" name="state" id="form6Example2" class="form-control" placeholder="State / Province" />

                </div>
              </div>
            </div>

            <!-- 2 column grid layout with text inputs for the City and  state -->
            <div class="row mb-4">
              <div class="col">
                
                <div class="form-outline">

                  <input type="number" name="pincode" id="form6Example1" class="form-control " placeholder="Postal / Zip Code" />

                </div>
              </div>
              <div class="col">
                <div class="form-outline">

                  <input type="text" name="country" id="form6Example2" class="form-control" placeholder="Country" />

                </div>
              </div>
            </div>

            <!-- Message input -->
            <div class="form-outline mb-1 ">
              <label class="form-label" for="form6Example7">Payment Methods</label>
             
            </div>
            <!-- Paymethods Check Box -->
            <div class="form-outline mb-4  m-l-25">
              
              <!-- Default checked radio -->
              <div class="form-check">
                <input class="form-check-input" type="radio" name="payment-method" id="flexRadioDefault1" value="COD"  checked/>
                <label class="form-check-label" for="flexRadioDefault1">COD </label>
              </div>

              <!-- Default checked radio -->
              <div class="form-check">
                <input class="form-check-input" type="radio" name="payment-method" id="flexRadioDefault2" value="Online method"
                  />
                <label class="form-check-label" for="flexRadioDefault2"> Online Pay </label>
              </div>
            </div>

            

            <!-- Submit button -->
            <button type="submit" class="btn btn-primary btn-block mb-4">Place order</button>
          
        </div>
      </form>




      </div>
    </div>
 
  </div>
</div>
</div>

 <!-- include the footer section -->
 <%- include('../partial/user_footer.ejs') %>
 <!-- include the footer section of html of User-->
 <%- include('../layouts/Users/footer.ejs') %>
 <script>
   $('#Checkout-form').submit((e)=>{
    e.preventDefault()
    $.ajax({
      url:'/place-order',
      method:'post',
      data:$('#Checkout-form').serialize(),
      success:(response)=>{
        alert(response)
        if(response.CODSuccess){
          location.href='/success-banner'
        }
        else{
          console.log(response) 
          razorpaycalling(response)
        }
      }

    })
  })
  function razorpaycalling(order){
   
   var options = {
       "key": "rzp_test_r2EEddYAuPS5ln", // Enter the Key ID generated from the Dashboard
       "amount": order.amount, // Amount is in currency subunits. Default currency is INR. Hence, 50000 refers to 50000 paise
       "currency": "INR",
       "name": "freshgreen",
       "description": "Test Transaction",
       "image": "https://cdn.mos.cms.futurecdn.net/m5ADpuAdKTpadnUWmsCrHJ-970-80.jpg.webp",
       "order_id": order.id, //This is a sample Order ID. Pass the `id` obtained in the response of Step 1
       "handler": function (response){
          
        verifypayment(response,order)
       },
       "prefill": {
           "name": "Rahul A",
           "email": "gaurav.kumar@example.com",
           "contact": "9000090000"
       },
       "notes": {
           "address": "Razorpay Corporate Office"
       },
       "theme": {
           "color": "#3399cc"
       }
   };
   var rzp1 = new Razorpay(options);
        rzp1.open();
     }

     function verifypayment(payment,order){
       console.log(payment)
       $.ajax({
         url:'/verify-payment',
         method:"post",
         data:{
          payment,
           order
         },
         success: function (response){
           if(response.status){
             location.href='/success-banner'
           }
           else{
            alert('verification Failed')
             
           }
         },
         error:(error)=>{
           console.log(error)
         }
         
   
       })
     }
 </script>